<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>會展人才培育與認證 - 國際認證考試</title>
    <meta name="description" content="培育我國會展產業從業人員之專業技能，建立會展產業認證制度及人才資料庫，逐步提昇人才素質，促使台灣會展人才資源適才適用。">
    <meta name="keywords" content="會展,國際認證,CEM,CMP,CIS">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* 基本樣式 */
        .c-header {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 10px 0;
        }
        
        .c-main {
            min-height: 80vh;
            padding-top: 20px;
        }
        
        .pageheader-block {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }
        
        .pageheader-block .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .pageheader-block .english {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 30px;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            color: #6c757d;
        }
        
        .pagesearch-outer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .pagetab-outer {
            margin-bottom: 30px;
        }
        
        .nav-pills .nav-link.active {
            background-color: #007bff;
        }
        
        /* 卡片樣式 */
        .card-outer {
            margin-bottom: 40px;
        }
        
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 30px;
            height: 100%;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .card-img {
            height: 200px;
            background-size: cover;
            background-position: center;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        
        .card-title a {
            color: #333;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .card-title a:hover {
            color: #007bff;
            text-decoration: none;
        }
        
        .card-text {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-tag {
            margin-top: 15px;
        }
        
        .card-tag span {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .card-meta {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
            color: #888;
        }
        
        .card-meta .badge {
            margin-right: 10px;
        }
        
        /* Loading 樣式 */
        .loading-spinner {
            text-align: center;
            padding: 50px;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        /* 錯誤提示樣式 */
        .error-message {
            text-align: center;
            padding: 50px;
            color: #dc3545;
        }
        
        /* 空狀態樣式 */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        /* 統計資訊樣式 */
        .stats-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        /* 搜索結果高亮 */
        .search-highlight {
            background-color: #fff3cd;
            padding: 1px 3px;
            border-radius: 3px;
        }
        
        .c-footer {
            background: #333;
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="c-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo">
                        <h4 class="mb-0">MICE培訓平台</h4>
                    </div>
                </div>
                <div class="col-md-9">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item"><a href="#" class="nav-link">首頁</a></li>
                            <li class="nav-item"><a href="#" class="nav-link">關於MICE</a></li>
                            <li class="nav-item"><a href="#" class="nav-link">最新消息</a></li>
                            <li class="nav-item"><a href="#" class="nav-link active">課程與認證</a></li>
                            <li class="nav-item"><a href="#" class="nav-link">活動花絮</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN -->
    <section class="c-main">
        <!-- 頁面標頭 -->
        <div class="pageheader-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-2">
                        <div class="icon text-center">
                            <i class="fas fa-certificate fa-3x"></i>
                        </div>
                    </div>
                    <div class="col-md-10">
                        <div class="title">國際認證考試</div>
                        <div class="english">International Certification Exams</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 頁面內容 -->
        <div class="container">
            <!-- 麵包屑 -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">首頁</li>
                    <li class="breadcrumb-item">課程與認證</li>
                    <li class="breadcrumb-item">認證考試</li>
                    <li class="breadcrumb-item active">國際認證考試</li>
                </ol>
            </nav>

            <!-- 搜索區塊 -->
            <div class="pagesearch-outer">
                <form class="form-inline" id="searchForm">
                    <div class="form-group mr-3">
                        <label class="mr-2">關鍵字：</label>
                        <input type="text" id="searchKeyword" class="form-control" placeholder="輸入考試名稱或關鍵字">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> 搜尋
                    </button>
                    <button type="button" id="clearSearch" class="btn btn-outline-secondary ml-2">
                        <i class="fas fa-times"></i> 清除
                    </button>
                </form>
            </div>

            <!-- 統計信息 -->
            <div id="statsInfo" class="stats-info" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <span id="statsText"></span>
            </div>

            <!-- 標籤頁 -->
            <div class="pagetab-outer">
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a href="#content1" class="nav-link active" data-toggle="pill">
                            國際認證介紹(CEM/CMP/CIS)
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">報名國際認證課程</a>
                    </li>
                </ul>
            </div>

            <!-- 內容區域 -->
            <div class="tab-content">
                <div id="content1" class="tab-pane active">
                    <!-- Loading 狀態 -->
                    <div id="loadingState" class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">載入中...</span>
                        </div>
                        <p class="mt-3">正在載入考試資料...</p>
                    </div>

                    <!-- 錯誤狀態 -->
                    <div id="errorState" class="error-message" style="display: none;">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h4>載入失敗</h4>
                        <p id="errorMessage">無法載入考試資料，請稍後再試。</p>
                        <button class="btn btn-primary" onclick="loadExams()">
                            <i class="fas fa-redo"></i> 重新載入
                        </button>
                    </div>

                    <!-- 空狀態 -->
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-inbox fa-3x mb-3"></i>
                        <h4>沒有找到考試資料</h4>
                        <p>目前沒有符合條件的國際認證考試。</p>
                    </div>

                    <!-- 考試卡片容器 -->
                    <div id="examContainer" class="card-outer course-outer">
                        <div class="row" id="examCards">
                            <!-- 動態生成的考試卡片將在這裡顯示 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="c-footer" style="padding-bottom: 0px;">
    <div class="fatfooter-block">
        <div class="container-fluid">
            <div class="row">
                <div class="col-link">
                    <div class="fatfooter-outer">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E5%9C%8B%E9%9A%9B%E8%AA%8D%E8%AD%89%E5%9F%B9%E8%A8%93#" class="nav-link">關於MICE</a>
                                <div class="content-menu">
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/introduction" class="content-item">計畫介紹</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/benchmark" class="content-item">職能基準</a>
                                    
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/news/1" class="content-item">最新消息</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-link">
                    <div class="fatfooter-outer">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E5%9C%8B%E9%9A%9B%E8%AA%8D%E8%AD%89%E5%9F%B9%E8%A8%93#" class="nav-link">課程與認證</a>
                                <div class="content-menu">
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E6%9C%83%E5%B1%95%E6%B2%99%E9%BE%8D" class="content-item">會展沙龍</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E5%9C%8B%E9%9A%9B%E8%AA%8D%E8%AD%89%E5%9F%B9%E8%A8%93" class="content-item">國際認證培訓</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E5%9C%8B%E5%85%A7%E8%AA%8D%E8%AD%89%E5%9F%B9%E8%A8%93" class="content-item">國內認證培訓</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/exam/%E5%9C%8B%E9%9A%9B%E8%AA%8D%E8%AD%89%E8%80%83%E8%A9%A6" class="content-item">國際認證考試</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/exam/%E5%9C%8B%E5%85%A7%E8%AA%8D%E8%AD%89%E8%80%83%E8%A9%A6" class="content-item">國內認證考試</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/books" class="content-item">會議展覽叢書</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-link">
                    <div class="fatfooter-outer">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="https://mice2.tako.life/meettaiwan/training/mice/course/%E5%9C%8B%E9%9A%9B%E8%AA%8D%E8%AD%89%E5%9F%B9%E8%A8%93#" class="nav-link">活動花絮</a>
                                <div class="content-menu">
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/activity/video" class="content-item">影音</a>
                                    <a href="https://mice2.tako.life/meettaiwan/training/mice/activity/photo" class="content-item">照片</a>
                                    
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-data">
                    <div class="fatfooter-outer">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="javascript:void(0);" class="nav-link">聯絡我們</a>
                                <div class="content-menu">
                                    <div class="content-item">
                                        <a href="javascript:void(0);" data-toggle="modal" data-target="#openPrivacy">個人資訊隱私權保護聲明</a> | <a href="javascript:void(0);" data-toggle="modal" data-target="#openSecurity">網路使用安全相關保護聲明</a><br>
                                        主辦單位：經濟部國際貿易署、中華民國對外貿易發展協會<br>
                                        信箱：<a href="mailto:irenechen@taitra.org.tw">irenechen@taitra.org.tw</a>
                                        
                                        <br>
                                        <span id="digtiplace">訪客人數：<span class="digit-counter">3</span><span class="digit-counter">3</span><span class="digit-counter">0</span><span class="digit-counter">9</span><span class="digit-counter">3</span><span class="digit-counter">3</span><span class="digit-counter">4</span></span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="community-outer">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="https://www.facebook.com/miceiti/" class="nav-link" target="_blank"><i class="icon"><img data-src="https://mice2.tako.life/meettaiwan/training/mice/mice/images/icon_facebook.png"></i></a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.youtube.com/channel/UCDlAeVi8iwdXoI5Hf6KULyw" class="nav-link" target="_blank"><i class="icon"><img data-src="https://mice2.tako.life/meettaiwan/training/mice/mice/images/icon_youtube.png"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright-block">
        <div class="container-fluid">
            <div class="row">
                <div class="col-logo">
                    <div class="logo"><a href="https://mice2.tako.life/meettaiwan/training/mice"><img data-src="https://mice2.tako.life/meettaiwan/training/mice/mice/images/logo_2023_07_03.png"></a></div>
                </div>
                <div class="col-copyright">
                    <div class="copyright">Copyright © 2023 經濟部國際貿易署 版權所有</div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        // API 配置
        const API_BASE_URL = 'http://localhost:3000/api';
        let allExams = []; // 儲存所有考試資料
        let currentExams = []; // 當前顯示的考試資料

        // 頁面載入完成後初始化
        $(document).ready(function() {
            loadExams();
            initializeEventListeners();
        });

        // 初始化事件監聽器
        function initializeEventListeners() {
            // 搜索表單提交
            $('#searchForm').on('submit', function(e) {
                e.preventDefault();
                performSearch();
            });

            // 清除搜索
            $('#clearSearch').on('click', function() {
                $('#searchKeyword').val('');
                showAllExams();
            });

            // 搜索框即時搜索
            $('#searchKeyword').on('input', function() {
                const keyword = $(this).val().trim();
                if (keyword === '') {
                    showAllExams();
                } else {
                    performLocalSearch(keyword);
                }
            });
        }

        // 載入考試資料
        function loadExams() {
            showLoadingState();
            
            $.ajax({
                url: `${API_BASE_URL}/international_exams`,
                method: 'GET',
                timeout: 10000, // 10秒超時
                success: function(response) {
                    console.log('API Response:', response);
                    
                    if (response.success && response.data && response.data.exams) {
                        allExams = response.data.exams;
                        currentExams = [...allExams];
                        renderExams(currentExams);
                        updateStats(response.count || allExams.length);
                        hideLoadingState();
                    } else {
                        showErrorState('API 回應格式錯誤');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('API Error:', xhr, status, error);
                    let errorMessage = '載入失敗，請檢查網路連線。';
                    
                    if (xhr.status === 404) {
                        errorMessage = 'API 端點不存在，請檢查服務器設定。';
                    } else if (xhr.status === 500) {
                        errorMessage = '服務器內部錯誤，請稍後再試。';
                    } else if (status === 'timeout') {
                        errorMessage = '請求超時，請檢查網路連線。';
                    }
                    
                    showErrorState(errorMessage);
                }
            });
        }

        // 渲染考試卡片
        function renderExams(exams) {
            const container = $('#examCards');
            container.empty();

            if (!exams || exams.length === 0) {
                showEmptyState();
                return;
            }

            exams.forEach(exam => {
                const cardHtml = createExamCard(exam);
                container.append(cardHtml);
            });

            hideEmptyState();
        }

        // 創建考試卡片HTML
        function createExamCard(exam) {
            // 處理標籤
            const tags = exam.tags || [];
            const tagsHtml = tags.map(tag => `<span>${tag}</span>`).join('');

            // 處理描述文字長度
            const description = exam.description || '暫無描述';
            const truncatedDescription = description.length > 150 ? 
                description.substring(0, 150) + '...' : description;

            // 處理圖片
            const imageUrl = exam.image_url || '';
            const imageStyle = imageUrl ? 
                `background-image: url('${imageUrl}')` : 
                'background-color: #f8f9fa; display: flex; align-items: center; justify-content: center;';

            // 處理額外信息
            const level = exam.level ? `<span class="badge badge-primary">${exam.level}</span>` : '';
            const duration = exam.duration ? `<span class="badge badge-info">${exam.duration}</span>` : '';
            const fees = exam.fees ? `<span class="badge badge-success">$${exam.fees.registration || 'N/A'}</span>` : '';

            return `
                <div class="col-lg-4 col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <a href="javascript:void(0);" onclick="showExamDetail('${exam.id}')">
                                <div class="card-img" style="${imageStyle}">
                                    ${!imageUrl ? '<i class="fas fa-certificate fa-3x text-muted"></i>' : ''}
                                </div>
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                <a href="javascript:void(0);" onclick="showExamDetail('${exam.id}')">
                                    ${exam.title || '未命名考試'}
                                </a>
                            </div>
                            <div class="card-text">
                                ${truncatedDescription}
                            </div>
                            ${tagsHtml ? `<div class="card-tag">${tagsHtml}</div>` : ''}
                            ${level || duration || fees ? `
                                <div class="card-meta">
                                    ${level} ${duration} ${fees}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // 執行搜索
        function performSearch() {
            const keyword = $('#searchKeyword').val().trim();
            
            if (keyword === '') {
                showAllExams();
                return;
            }

            // 使用 API 搜索
            $.ajax({
                url: `${API_BASE_URL}/search/exams`,
                method: 'GET',
                data: {
                    q: keyword,
                    type: 'international'
                },
                success: function(response) {
                    if (response.success) {
                        const searchResults = response.results.international || [];
                        currentExams = searchResults;
                        renderExams(searchResults);
                        updateStats(searchResults.length, `搜索 "${keyword}" 的結果`);
                    }
                },
                error: function() {
                    // 如果API搜索失敗，使用本地搜索
                    performLocalSearch(keyword);
                }
            });
        }

        // 本地搜索（備用方案）
        function performLocalSearch(keyword) {
            const searchTerm = keyword.toLowerCase();
            const filteredExams = allExams.filter(exam => {
                return (exam.title && exam.title.toLowerCase().includes(searchTerm)) ||
                       (exam.description && exam.description.toLowerCase().includes(searchTerm)) ||
                       (exam.exam_type && exam.exam_type.toLowerCase().includes(searchTerm)) ||
                       (exam.tags && exam.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
            });

            currentExams = filteredExams;
            renderExams(filteredExams);
            updateStats(filteredExams.length, `搜索 "${keyword}" 的結果`);
        }

        // 顯示所有考試
        function showAllExams() {
            currentExams = [...allExams];
            renderExams(currentExams);
            updateStats(allExams.length);
        }

        // 顯示考試詳情
        function showExamDetail(examId) {
            const exam = allExams.find(e => e.id === examId);
            if (!exam) return;

            // 創建詳情內容
            const detailContent = `
                <div class="exam-detail">
                    <h4>${exam.title}</h4>
                    <p><strong>考試類型：</strong>${exam.exam_type || 'N/A'}</p>
                    <p><strong>等級：</strong>${exam.level || 'N/A'}</p>
                    <p><strong>考試時間：</strong>${exam.duration || 'N/A'}</p>
                    <p><strong>考試形式：</strong>${exam.format || 'N/A'}</p>
                    <p><strong>及格分數：</strong>${exam.pass_score || 'N/A'}</p>
                    <p><strong>證書有效期：</strong>${exam.certification_validity || 'N/A'}</p>
                    <p><strong>描述：</strong>${exam.description || '暫無描述'}</p>
                    
                    ${exam.requirements ? `
                        <div class="mt-3">
                            <strong>報考資格：</strong>
                            <ul>
                                ${exam.requirements.map(req => `<li>${req}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${exam.benefits ? `
                        <div class="mt-3">
                            <strong>認證優勢：</strong>
                            <ul>
                                ${exam.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${exam.contact_info ? `
                        <div class="mt-3">
                            <strong>聯絡資訊：</strong><br>
                            機構：${exam.contact_info.organization || 'N/A'}<br>
                            電話：${exam.contact_info.phone || 'N/A'}<br>
                            Email：${exam.contact_info.email || 'N/A'}<br>
                            網站：${exam.contact_info.website ? `<a href="${exam.contact_info.website}" target="_blank">${exam.contact_info.website}</a>` : 'N/A'}
                        </div>
                    ` : ''}
                </div>
            `;

            // 使用Bootstrap Modal顯示詳情
            if ($('#examDetailModal').length === 0) {
                $('body').append(`
                    <div class="modal fade" id="examDetailModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">考試詳情</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body"></div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
            }

            $('#examDetailModal .modal-body').html(detailContent);
            $('#examDetailModal').modal('show');
        }

        // 更新統計信息
        function updateStats(count, searchInfo = '') {
            const statsText = searchInfo || `共找到 ${count} 個國際認證考試`;
            $('#statsText').text(statsText);
            $('#statsInfo').show();
        }

        // 狀態控制函數
        function showLoadingState() {
            $('#loadingState').show();
            $('#errorState').hide();
            $('#emptyState').hide();
            $('#examContainer').hide();
            $('#statsInfo').hide();
        }

        function hideLoadingState() {
            $('#loadingState').hide();
            $('#examContainer').show();
        }

        function showErrorState(message) {
            $('#loadingState').hide();
            $('#examContainer').hide();
            $('#emptyState').hide();
            $('#statsInfo').hide();
            $('#errorMessage').text(message);
            $('#errorState').show();
        }

        function showEmptyState() {
            $('#examContainer').hide();
            $('#emptyState').show();
        }

        function hideEmptyState() {
            $('#emptyState').hide();
        }
    </script>
</body>
</html>
